<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>coder • coder</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="coder">
<meta property="og:description" content="coder">
<meta property="og:image" content="ropensci.github.io/coder/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coder</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.13.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/coder.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/classcodes.html">Classcodes</a>
    </li>
    <li>
      <a href="../articles/ex_data.html">Example data</a>
    </li>
    <li>
      <a href="../articles/Interpret_regular_expressions.html">Interpret regular expressions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/coder/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>coder</h1>
                        <h4 data-toc-skip class="author">Erik Bulow</h4>
            
            <h4 data-toc-skip class="date">2022-08-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/coder/blob/HEAD/vignettes/coder.Rmd" class="external-link"><code>vignettes/coder.Rmd</code></a></small>
      <div class="hidden name"><code>coder.Rmd</code></div>

    </div>

    
    
<p>The <code>coder</code> package simplifies unit classification based
on external code data. this is a generic aim that might be hard to grasp
without further concretization. In this vignette, I will first explain
the overall design principles, and then exemplify the concept with a
typical use case involving patients with total hip arthroplasty (THA)
and their pre-surgery comorbidity. Note, however, that the package is
not limited to patient data or medical settings.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/coder/" class="external-link">coder</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="triad-of-objects">Triad of objects<a class="anchor" aria-label="anchor" href="#triad-of-objects"></a>
</h2>
<p>Functions of the package relies on a triad of objects:</p>
<ol style="list-style-type: decimal">
<li>Case data with unit id:s and possible dates of interest</li>
<li>External code data for corresponding units in (1) and with optional
dates of interest and</li>
<li>A classification scheme (‘classcodes’ object) with regular
expressions to identify and categorize relevant codes from (2).</li>
</ol>
<p>It is easy to introduce new classification schemes (‘classcodes’
objects) or to use default schemes included in the package (see
<code><a href="../articles/classcodes.html">vignette("classcodes")</a></code>).</p>
</div>
<div class="section level2">
<h2 id="triad-of-functions">Triad of functions<a class="anchor" aria-label="anchor" href="#triad-of-functions"></a>
</h2>
<p>There are three important functions to control the intended work flow
of the package:</p>
<ol style="list-style-type: lower-roman">
<li>
<code><a href="../reference/codify.html">codify()</a></code> will merge object (1) and (2) for a coded data
set of the intended format. If optional dates are specified, those will
be used to construct time windows in order to filter out only the
important dates (i.e. comorbidity during one year before surgery or
adverse events 90 days after).</li>
<li>
<code><a href="../reference/classify.html">classify()</a></code> will then use the coded data and classify it
using the <code>classcodes</code> object (3) (i.e. to code comorbidity
data by the Charlson or Elixhauser comorbidity classifications).</li>
<li>
<code><a href="../reference/index_fun.html">index()</a></code> is a third optional step to summarize the
individual <code>classcodes</code> categories to a (possibly weighted)
index sum for each coded item (i.e. to calculate the Charlson
comorbidity index for each patient).</li>
</ol>
<p>Those steps could be performed explicitly as
<code>codify() %&gt;% classify() %&gt;% index()</code> or implicitly by
the main function <code><a href="../reference/categorize.html">categorize()</a></code> combining all steps
automatically.</p>
</div>
<div class="section level2">
<h2 id="use-case">Use case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>A typical use case of the <code>coder</code> package would consider
patient data and comorbidity as described in the package <a href="https://docs.ropensci.org/coder/" class="external-link">readme</a>.</p>
<p>The concept of comorbidity is often attributed to Feinstein <span class="citation">(1970)</span>:</p>
<blockquote>
<p>[T]he term co-morbidity will refer to any distinct additional
clinical entity that has existed or that may occur during the clinical
course of a patient who has the index disease under study.</p>
</blockquote>
<p>Let’s consider a group of patients with THA, as identified from a
national quality register, which might be large in size. Assume we are
interested in those patients’ pre-surgery comorbidity, which is not
captured by the quality register itself. Instead, this data might be
codified in a secondary source, such as a national patient register
containing all hospital visits and admissions during several years, both
before and after the THA-surgery. Each hospital visit/admission might be
recorded with one or several medical codes, for example using the
International classification of diseases version 10 (ICD-10). Similarly,
a medical prescription register might hold records of prescribed drugs
with their corresponding codes from the Anatomic therapeutic chemical
classification (ATC) system.</p>
<p>Thus, combining the primary and secondary data sets (objects 1-2
above) using some unique patient id, and a possible time window (i.e. to
only consider comorbidity as recorded during one year before the THA),
is a first step to identify patient comorbidity. This step is performed
by the <code><a href="../reference/codify.html">codify()</a></code> function in step (i) above.</p>
<p>We have now gathered all the relevant codes for each patient. Common
classifications (i.e. ICD-10 and ATC) are wast, however, including tens
of thousands of medical/chemical codes, which are cumbersome and
impractical to use directly. It is therefore common to categorize such
codes into broader categories (i.e. by the Charlson, Elixhauser or
RxRisk V classifications as below). Such classification could be a
simple code matching problem using a look-up table. This is generally a
slow, cumbersome and error-prone process, however. I therefore recommend
to use regular expression for a compact code representation, as well as
a computationally faster procedure. This is implemented in the
<code><a href="../reference/classify.html">classify()</a></code> function from step (ii) above.</p>
<p>We have now reduced the data from tens of thousands of codes to
perhaps 10-50 combined categories. This might be sufficient in some
cases, although further simplifications might also be needed. It is thus
common to simplify comorbidity into a single number, an index score, as
the sum of individual comorbidities, possible weighted to differentiate
more serious conditions from more trivial. Different weights might be of
relevance under different circumstances or in different fields. This is
implemented by the <code><a href="../reference/index_fun.html">index()</a></code> function in step (iii)
above.</p>
</div>
<div class="section level2">
<h2 id="charlson-and-elixhauser">Charlson and Elixhauser<a class="anchor" aria-label="anchor" href="#charlson-and-elixhauser"></a>
</h2>
<p>The Charlson <span class="citation">(1987)</span> and Elixhauser
<span class="citation">(1998)</span> comorbidity indices are two
examples used in medical research. Each index consist of several medical
conditions, possibly summarized by a (weighted) index. Each condition is
defined by a set of medical codes <span class="citation">(Quan et al.
2005)</span>. Different versions of the International Classification of
Diseases (ICD) codes are often used.</p>
<p>The <code>coder</code> package provides substantial functionality for
both Charlson and Elixhauser, although we will not focus on those
indices here (but see examples in <code><a href="../articles/classcodes.html">vignette("classcodes")</a></code>).
Several other R packages have functions for Charlson and Elixhauser:</p>
<ul>
<li><a href="https://CRAN.R-project.org/package=icd" class="external-link">icd (CRAN)</a></li>
<li><a href="https://CRAN.R-project.org/package=comorbidity" class="external-link">comorbidity
(CRAN)</a></li>
<li><a href="https://CRAN.R-project.org/package=medicalrisk" class="external-link">medicalrisk
(CRAN)</a></li>
<li><a href="https://github.com/gforge/comorbidities.icd10" class="external-link">comorbidities.icd10
(GitHub)</a></li>
<li><a href="https://github.com/wtcooper/icdcoder" class="external-link">icdcoder
(GitHub)</a></li>
</ul>
<p><code>icd</code> and <code>comorbidity</code> are both good packages
well suited for their purpose based on effective implementations.
<code>medicalrisk</code> can be used with ICD-9-CM codes but is not
up-to-date with the latest version of ICD-10.
<code>comorbidities.icd10</code> and <code>icdcoder</code> are not
actively developed or maintained.</p>
<p>One advantage with the <code>coder</code> package is the great
flexibility for combining different sets of codes (ICD-8, ICD-9,
ICD-9-CM and ICD-10 et cetera), with different weighted indices.</p>
</div>
<div class="section level2">
<h2 id="risk-rx-v">Risk Rx V<a class="anchor" aria-label="anchor" href="#risk-rx-v"></a>
</h2>
<p>Another advantage of the <code>coder</code> package is the inclusion
of additional classifications (see <code>?all_classcodes()</code>), such
as the pharmacy-based case-mix instrument Rx Risk V <span class="citation">(Sloan et al. 2003)</span>. We will use this
classification in an example. This classification, in contrast to
Charlson and Elixhauser, relies on medical prescription data codified by
the Anatomic Therapeutic Chemical classification system (ATC).</p>
<p>As for all classcodes objects in the package, additional information
and references are found in the object documentation
(<code><a href="../reference/rxriskv.html">?rxriskv</a></code>).</p>
</div>
<div class="section level2">
<h2 id="concrete-example">Concrete example<a class="anchor" aria-label="anchor" href="#concrete-example"></a>
</h2>
<p>Let us consider the hypothetical setting above using some example
data (<code>ex_peopple</code> and <code>ex_atc</code>) as described in
<code><a href="../articles/ex_data.html">vignette("ex_data")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="default-categorization">Default categorization<a class="anchor" aria-label="anchor" href="#default-categorization"></a>
</h2>
<p>A first attempt to calculate the Rx Risk V score for each
patient:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span></span>
<span>    <span class="va">ex_people</span>, codedata <span class="op">=</span> <span class="va">ex_atc</span>, cc <span class="op">=</span> <span class="va">rxriskv</span>, id <span class="op">=</span> <span class="st">"name"</span>, code <span class="op">=</span> <span class="st">"atc"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classification based on: atc_pratt</span></span>
<span><span class="va">default</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 50</span></span></span>
<span><span class="co">#&gt;    name       surgery    Alcoh…¹ Aller…² Antic…³ Antip…⁴ Anxiety Arrhy…⁵ Benig…⁶</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Chen, Tre… 2022-08-12 FALSE   TRUE    TRUE    FALSE   FALSE   FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Graves, A… 2022-05-04 FALSE   FALSE   FALSE   FALSE   FALSE   FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Trujillo,… 2022-04-21 FALSE   FALSE   FALSE   FALSE   FALSE   FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Simpson, … 2022-07-24 FALSE   TRUE    FALSE   FALSE   FALSE   FALSE   TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Chin, Nel… 2022-07-07 FALSE   FALSE   FALSE   TRUE    FALSE   FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Le, Chris… 2022-02-08 FALSE   FALSE   FALSE   FALSE   FALSE   FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Kang, Xuan 2022-05-13 FALSE   TRUE    FALSE   TRUE    TRUE    FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Shuemaker… 2022-02-09 FALSE   FALSE   FALSE   FALSE   FALSE   FALSE   TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Boucher, … 2022-07-18 FALSE   FALSE   FALSE   FALSE   TRUE    TRUE    FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Le, Sorai… 2022-06-22 FALSE   FALSE   FALSE   FALSE   FALSE   FALSE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 90 more rows, 41 more variables: Bipolar.disorder &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Chronic.airways.disease &lt;lgl&gt;, Congestive.heart.failure &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Dementia &lt;lgl&gt;, Depression &lt;lgl&gt;, Diabetes &lt;lgl&gt;, Epilepsy &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Gastrooesophageal.reflux.disease &lt;lgl&gt;, Glaucoma &lt;lgl&gt;, Gout &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Hepatitis.B &lt;lgl&gt;, Hepatitis.C &lt;lgl&gt;, HIV &lt;lgl&gt;, Hyperkalaemia &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Hyperlipidaemia &lt;lgl&gt;, Hypertension &lt;lgl&gt;, Hyperthyroidism &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Hypothyroidism &lt;lgl&gt;, Incontinence &lt;lgl&gt;, Inflammation.pain &lt;lgl&gt;, …</span></span></span></code></pre></div>
<p>The first two columns are identical to <code>ex_people</code>.
Additional columns indicate whether patients had any of the individual
comorbidities identified by Rx Risk V. Patients without any medical
prescriptions have <code>NA</code> values (which might be substituted by
<code>FALSE</code>). The last columns contain summarized index values
(weighted sums of individual comorbidities). Let’s summarize the
distribution of a weighted index according to <code>pratt</code> <span class="citation">(Pratt et al. 2018)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hist2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">pratt</span>, main <span class="op">=</span> <span class="cn">NULL</span>, xlab <span class="op">=</span> <span class="st">"RxRisk V"</span>, col <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">hist2</span><span class="op">(</span><span class="va">default</span><span class="op">)</span></span></code></pre></div>
<p><img src="coder_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="specified-time-window">Specified time-window<a class="anchor" aria-label="anchor" href="#specified-time-window"></a>
</h2>
<p>Some prescriptions might have been filed long before surgery, or even
after. Those codes are less relevant for comorbidities present at
surgery. We can limit the categorization to a time window of one year
(365 days) prior to surgery. This is done internally by the
<code><a href="../reference/codify.html">codify()</a></code> function, hence by specifying a list of arguments
passed to this function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codify_args</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>date <span class="op">=</span> <span class="st">"surgery"</span>, code_date <span class="op">=</span> <span class="st">"prescription"</span>, days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">365</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ct</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span></span>
<span>    <span class="va">ex_people</span>, </span>
<span>    codedata    <span class="op">=</span> <span class="va">ex_atc</span>, </span>
<span>    cc          <span class="op">=</span> <span class="va">rxriskv</span>, </span>
<span>    id          <span class="op">=</span> <span class="st">"name"</span>, </span>
<span>    code        <span class="op">=</span> <span class="st">"atc"</span>, </span>
<span>    codify_args <span class="op">=</span> <span class="va">codify_args</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Classification based on: atc_pratt</span></span>
<span>  </span>
<span><span class="fu">hist2</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span></span></code></pre></div>
<p><img src="coder_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="alternative-classification">Alternative classification<a class="anchor" aria-label="anchor" href="#alternative-classification"></a>
</h2>
<p>Comorbidities are identified from ATC codes captured by regular
expression (see <code><a href="../articles/classcodes.html">vignette("classcodes")</a></code> and
<code>vignette("Intrpret_regular_expressions")</code>). Codes identified
by <code>atc_pratt</code> are used by default. Let’s use an alternative
version adopted from Caughy <span class="citation">(2010)</span> as
specified by an argument passed by the <code>cc_args</code>
argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hist2</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span></span>
<span>    <span class="va">ex_people</span>, </span>
<span>    codedata      <span class="op">=</span> <span class="va">ex_atc</span>, </span>
<span>    cc            <span class="op">=</span> <span class="va">rxriskv</span>, </span>
<span>    id            <span class="op">=</span> <span class="st">"name"</span>, </span>
<span>    code          <span class="op">=</span> <span class="st">"atc"</span>,</span>
<span>    codify_args   <span class="op">=</span> <span class="va">codify_args</span>,</span>
<span>    cc_args       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>regex <span class="op">=</span> <span class="st">"caughey"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="coder_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="specified-index">Specified index<a class="anchor" aria-label="anchor" href="#specified-index"></a>
</h2>
<p>We did not specify how to calculate the weighted index sum above,
wherefore all available indices were provided by default. We might go
back to Pratt’s classification scheme (<code>atc_pratt</code>) and only
calculate the corresponding index <code>pratt</code>. Let´s also perform
the three computational steps explicitly instead of using the combining
<code><a href="../reference/categorize.html">categorize()</a></code> function and tabulate the result</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/codify.html">codify</a></span><span class="op">(</span></span>
<span>  <span class="va">ex_people</span>, </span>
<span>  <span class="va">ex_atc</span>, </span>
<span>  id        <span class="op">=</span> <span class="st">"name"</span>, </span>
<span>  code      <span class="op">=</span> <span class="st">"atc"</span>,  </span>
<span>  date      <span class="op">=</span> <span class="st">"surgery"</span>, </span>
<span>  code_date <span class="op">=</span> <span class="st">"prescription"</span>,</span>
<span>  days      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">365</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/classify.html">classify</a></span><span class="op">(</span><span class="va">rxriskv</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/index_fun.html">index</a></span><span class="op">(</span><span class="st">"pratt"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: 'classify()' does not preserve row order ('categorize()' does!)</span></span>
<span><span class="co">#&gt; Classification based on: atc_pratt</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; -1  0  1  2  3  4  5  8 </span></span>
<span><span class="co">#&gt; 12 43  8 21  1  2  1  2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dirty-code-data">Dirty code data<a class="anchor" aria-label="anchor" href="#dirty-code-data"></a>
</h2>
<p>Let’s assume that our code data is not as clean as simulated
above.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1e3</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex_atc</span><span class="op">$</span><span class="va">code</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="fu">s</span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, <span class="fu">s</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, <span class="fu">s</span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, <span class="fu">s</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"."</span>, <span class="st">"-"</span>, <span class="st">"?"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    <span class="va">ex_atc</span><span class="op">$</span><span class="va">atc</span>, <span class="fu">s</span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, <span class="fu">s</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ex_atc</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10,000 × 4</span></span></span>
<span><span class="co">#&gt;    name                 atc      prescription code          </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Le, Soraiya          L03AA16  2020-05-15   w7e-L03AA16a9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Cleveland, Mark      J07CA01  2018-01-23   s1m?J07CA01n9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Santistevan, Charlie QJ57EA06 2013-07-04   q3g?QJ57EA06j3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Meier, Hayden        R03DB04  2018-11-04   b9c.R03DB04p8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Hill, Audrey         V09IA01  2016-04-18   p5c?V09IA01u4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Thumma, Phillip      L02AE02  2012-05-27   g2l?L02AE02o4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Yost, Rebecca        S01EB06  2016-10-19   z3t?S01EB06t5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Mandakh, Joseph      A03DA01  2018-05-23   i1d.A03DA01h1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Meier, Hayden        C09AA13  2020-11-11   i7y-C09AA13d8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Trinh, Schuyler      A07EA03  2022-09-11   d6e.A07EA03i1 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 9,990 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span></span>
<span>    <span class="va">ex_people</span>, </span>
<span>    codedata <span class="op">=</span> <span class="va">ex_atc</span>, </span>
<span>    cc       <span class="op">=</span> <span class="va">rxriskv</span>, </span>
<span>    id       <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>    code     <span class="op">=</span> <span class="st">"code"</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">pratt</span>,</span>
<span>  na.rm      <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Classification based on: atc_pratt</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Thus, no codes are recognized (every one got index = 0). By default,
codes are only recognized if found immediate in its corresponding
column. This can be controlled by arguments <code>start</code> and
<code>stop</code> specified via <code>cc_args</code>. We can also ignore
all non alphanumeric characters by setting <code>alnum = TRUE</code> as
passed to <code><a href="../reference/codify.html">codify()</a></code> by argument
<code>codify_args</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hist2</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span></span>
<span>    <span class="va">ex_people</span>, </span>
<span>    codedata <span class="op">=</span> <span class="va">ex_atc</span>, </span>
<span>    cc       <span class="op">=</span> <span class="va">rxriskv</span>, </span>
<span>    id       <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>    code     <span class="op">=</span> <span class="st">"code"</span>,</span>
<span>    cc_args  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      start  <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>      stop   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span>,</span>
<span>    codify_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      alnum <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Classification based on: atc_pratt</span></span></code></pre></div>
<p><img src="coder_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Caughey2010" class="csl-entry">
Caughey, Gillian E., Elizabeth E. Roughead, Agnes I. Vitry, Robyn A.
McDermott, Sepehr Shakib, and Andrew L. Gilbert. 2010.
<span>“Comorbidity in the Elderly with Diabetes: Identification of Areas
of Potential Treatment Conflicts.”</span> <em>Diabetes Research and
Clinical Practice</em> 87 (3): 385–93. <a href="https://doi.org/10.1016/j.diabres.2009.10.019" class="external-link">https://doi.org/10.1016/j.diabres.2009.10.019</a>.
</div>
<div id="ref-Charlson1987" class="csl-entry">
Charlson, Mary E., Peter Pompei, Kathy L. Ales, and C. Ronald MacKenzie.
1987. <span>“A New Method of Classifying Prognostic Comorbidity in
Longitudinal Studies: Development and Validation.”</span> <em>Journal of
Chronic Diseases</em> 40 (5): 373–83. <a href="https://doi.org/10.1016/0021-9681(87)90171-8" class="external-link">https://doi.org/10.1016/0021-9681(87)90171-8</a>.
</div>
<div id="ref-Elixhauser1998" class="csl-entry">
Elixhauser, Anne, Claudia Steiner, D Robert Harris, and Rosanna M
Coffey. 1998. <span>“Comorbidity Measures for Use with Administrative
Data.”</span> <em>Medical Care</em> 36 (1): 8–27.
</div>
<div id="ref-Feinstein1970" class="csl-entry">
Feinstein, Alvan R. 1970. <span>“The Pre-Therapeutic Classification of
Co-Morbidity in Chronic Disease.”</span> <em>Journal of Chronic
Diseases</em> 23 (7): 455–68. https://doi.org/<a href="https://doi.org/10.1016/0021-9681(70)90054-8" class="external-link">https://doi.org/10.1016/0021-9681(70)90054-8</a>.
</div>
<div id="ref-Pratt2018" class="csl-entry">
Pratt, Nicole L., Mhairi Kerr, John D. Barratt, Anna Kemp-Casey, Lisa M.
Kalisch Ellett, Emmae Ramsay, and Elizabeth Ellen Roughead. 2018.
<span>“The Validity of the Rx-Risk Comorbidity Index Using Medicines
Mapped to the Anatomical Therapeutic Chemical (ATC) Classification
System.”</span> <em>BMJ Open</em> 8 (4). <a href="https://doi.org/10.1136/bmjopen-2017-021122" class="external-link">https://doi.org/10.1136/bmjopen-2017-021122</a>.
</div>
<div id="ref-Quan2005" class="csl-entry">
Quan, Hude, Vijaya Sundararajan, Patricia Halfon, Andrew Fong, Bernard
Burnand, Jean-Christophe Luthi, L Duncan Saunders, Cynthia a Beck,
Thomas E Feasby, and William a Ghali. 2005. <span>“Coding Algorithms for
Defining Comorbidities in ICD-9-CM and ICD-10 Administrative
Data.”</span> <em>Medical Care</em> 43 (11): 1130–39. <a href="https://doi.org/10.1097/01.mlr.0000182534.19832.83" class="external-link">https://doi.org/10.1097/01.mlr.0000182534.19832.83</a>.
</div>
<div id="ref-Sloan2003" class="csl-entry">
Sloan, Kevin L, Anne E Sales, Chuan-Fen Liu, Paul Fishman, Paul Nichol,
Norman T Suzuki, and Nancy D Sharp. 2003. <span>“Construction and
Characteristics of the RxRisk-v: A VA-Adapted Pharmacy-Based Case-Mix
Instrument.”</span> <em>Medical Care</em> 41 (6): 761–74. <a href="https://doi.org/10.1097/01.MLR.0000064641.84967.B7" class="external-link">https://doi.org/10.1097/01.MLR.0000064641.84967.B7</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/ropensci" class="external-link">Erik Bulow</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
